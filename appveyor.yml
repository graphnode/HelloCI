version: 1.0.{build}

branches:
  only:
  - master
  
image: Visual Studio 2017

init:
  - ps: Update-AppveyorBuild -Version "$(Get-Date -format yyyyMMdd)-$(APPVEYOR_REPO_COMMIT)"
  
build_script:
- sh: >-
    dotnet restore

    dotnet build

    dotnet publish -r win-x64 -c release

    cd bin\release\netcoreapp2.1\win-x64\publish\

    7z.exe a "helloci-$(APPVEYOR_BUILD_VERSION)-win64.zip" .
    
artifacts:
- path: bin\release\netcoreapp2.1\win-x64\publish\*.zip
  name: HelloCI
  
deploy:
  artifact: /.*\.zip/
  provider: GitHub
  tag: $(APPVEYOR_BUILD_VERSION)
  auth_token:
    secure: qpEdvpJkR5kaDAqw5g/z7chnKwqLqaMYW1/yFazttmxXyBbZqxPUSPjOeexjo7uh
  repository: graphnode/HelloCI
  draft: false
  prerelease: false
  force_update: true